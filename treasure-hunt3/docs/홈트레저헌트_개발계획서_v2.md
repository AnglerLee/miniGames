# 홈 트레저헌트 (Home Treasure Hunt) - 개발 계획서 v2.0

> **버전:** v2.0 | **날짜:** 2026년 2월 14일
> **Tech Stack:** HTML5 + CSS3 + Vanilla JavaScript | **Storage:** localStorage
>
> **v2.0 변경사항:** 기존 `games/` 폴더에 구현된 20개 미니게임 및 `treasure-hunt/` 보물찾기 시스템 분석 결과를 반영하여 개발 계획서를 업데이트함

---

## 1. 기술 아키텍처

### 1.1 기술 스택

| 기술 | 용도 | 비고 |
|------|------|------|
| **HTML5** | 각 게임별 독립 페이지 | 멀티페이지 구조 |
| **CSS3** | CSS Custom Properties 기반 테마 전환 | 공통 스타일 + 게임별 스타일 |
| **Vanilla JavaScript (ES6+)** | 함수 기반 모듈화 구조 | 번들링 미사용, 클래스 미사용 |
| **localStorage** | 설정 저장, 게임 상태, 프리셋 관리 | `treasureHunt_` 접두사 |
| **DeviceMotion API** | 흔들기 감지 (에너지 충전) | iOS: `requestPermission()` 필요 |
| **DeviceOrientation API** | 자이로스코프 (컴퍼스, 폭탄 해체) | iOS: `requestPermission()` 필요 |
| **Web Audio API** | 효과음 합성 + 마이크 입력 분석 | AudioContext 싱글톤 관리 |
| **MediaDevices API** | 카메라/마이크 접근 | `getUserMedia()` |
| **Canvas API** | 미로 렌더링, 스크래치 카드 | 2D 컨텍스트 |
| **Vibration API** | 터치 피드백 진동 | `navigator.vibrate()` |
| **배포** | 정적 호스팅 (GitHub Pages 등) | 별도 백엔드 불필요 |

### 1.2 프로젝트 디렉토리 구조

> **기존 구현 기반:** 멀티페이지 아키텍처 (SPA 아님)

```
home-treasure-hunt/
│
├── index.html                          # 메인 허브 (게임 선택 화면)
├── admin.html                          # 중앙 관리자 대시보드
│
├── assets/
│   ├── css/
│   │   ├── common.css                  # 공통 스타일 (모달, 버튼, 컨테이너)
│   │   ├── admin.css                   # 관리자 페이지 스타일
│   │   └── admin-theme.css             # 관리자 테마 색상
│   └── js/
│       ├── common.js                   # 공통 유틸리티 (타이머, 사운드, 모달 등)
│       └── admin.js                    # 관리자 설정 관리
│
├── games/                              # ★ 20개 미니게임 (구현 완료)
│   ├── 02-maze/                        # 미로 탈출
│   │   ├── index.html                  # 게임 UI
│   │   ├── game.js                     # 게임 로직 (Canvas 기반)
│   │   ├── maps.js                     # 미로 데이터 (240KB+)
│   │   ├── admin.html                  # 게임별 관리자 설정
│   │   └── admin.js                    # 관리자 핸들러
│   ├── 03-card-match/                  # 짝 맞추기
│   ├── 05-sliding-puzzle/              # 숫자 퍼즐
│   ├── 07-math-race/                   # 빠른 계산
│   ├── 08-word-search/                 # 단어 찾기
│   ├── 11-sequence-tap/                # 순서대로 터치
│   ├── 12-color-rush/                  # 색깔 스피드
│   ├── 13-energy-charge/               # 에너지 충전
│   ├── 15-decibel-meter/               # 데시벨 측정기
│   ├── 16-magic-compass/               # 매직 컴퍼스
│   ├── 17-barcode-scanner/             # 바코드 스캐너
│   ├── 18-color-hunter/                # 컬러 헌터
│   ├── 19-reverse-audio/               # 리버스 오디오
│   ├── 20-emoji-quiz/                  # 이모지 넌센스
│   ├── 21-dual-touch/                  # 동시 터치 협동
│   ├── 22-wifi-hacker/                 # 와이파이 해커
│   ├── 23-safe-cracker/                # 디지털 금고 털이
│   ├── 24-bomb-balance/                # 폭탄 해체
│   ├── 25-scratch-card/                # 복권 긁기
│   └── 27-stopwatch/                   # 절대음감 스톱워치
│
├── treasure-hunt/                      # ★ 보물찾기 시스템 (구현 완료)
│   ├── index.html                      # 보물찾기 메인 (iframe으로 미니게임 로드)
│   ├── admin.html                      # 보물찾기 관리자 (프리셋 관리)
│   ├── css/
│   │   ├── main.css                    # 보물찾기 메인 스타일
│   │   ├── animations.css              # 애니메이션 효과
│   │   └── effects.css                 # 특수 효과
│   └── js/
│       ├── core.js                     # 핵심 로직 (프리셋/진행 관리)
│       ├── admin.js                    # 관리자 로직
│       ├── default-presets.js          # 기본 프리셋 데이터
│       ├── animations.js              # 애니메이션 로직
│       ├── sound-manager.js           # 효과음 관리
│       └── ui-effects.js              # UI 효과
│
└── treasure-hunt3/                     # ★ 신규 개발 (홈 트레저헌트)
    ├── index.html                      # 메인 진입 (S01)
    ├── admin.html                      # 관리자 진입 (S02) + 대시보드 (S03)
    ├── play.html                       # 게임 플레이 (S06 미니게임 / S07 물건찾기)
    ├── treasure.html                   # 보물 상자 (S08)
    ├── css/
    │   ├── common.css                  # 공통 스타일
    │   ├── themes.css                  # 테마별 CSS 변수 정의
    │   └── animations.css              # 공통 애니메이션
    ├── js/
    │   ├── app.js                      # 앱 초기화, 네비게이션
    │   ├── storage.js                  # localStorage 래퍼
    │   ├── theme-manager.js            # 테마 로드/전환
    │   ├── preset-data.js              # 프리셋 시나리오 데이터
    │   ├── game-engine.js              # 게임 상태 관리
    │   ├── mission-hub.js              # 미션 허브 화면 로직
    │   ├── mission-builder.js          # 미션 구성 UI 처리
    │   ├── treasure-box.js             # 보물 상자 로직
    │   └── effects.js                  # 컨페티, 파티클, 효과음
    └── docs/                           # 설계 문서
```

### 1.3 페이지 구성 방식

> **변경:** 기존 계획서의 SPA hash 라우팅 방식에서 **멀티페이지 구조**로 변경
> **근거:** 기존 games/ 폴더의 모든 미니게임이 독립 HTML 페이지로 구현되어 있으며, treasure-hunt/ 시스템도 iframe 기반으로 게임을 로드하는 멀티페이지 패턴을 사용 중

| 페이지 파일 | 화면 | 설명 |
|------------|------|------|
| `index.html` | 메인 진입 (S01) | 메인 화면, 시작/이어하기 버튼 |
| `admin.html` | 관리자 진입 (S02) + 대시보드 (S03) | PIN 입력 → 프리셋 설정, 미션 구성 |
| `index.html#intro` | 스토리 인트로 (S04) | 테마별 내레이션 (같은 페이지 내 섹션 전환) |
| `index.html#hub` | 미션 허브 (S05) | 전체 미션 표시, 진행도 |
| `play.html?type=mini&id=X` | 미니게임 플레이 (S06) | iframe으로 기존 미니게임 로드 |
| `play.html?type=find&id=X` | 물건 찾기 (S07) | 힌트 + 답변 입력 |
| `treasure.html` | 보물 상자 (S08) | 게임 완료 + 암호 입력 |

**미니게임 로드 방식:**
```javascript
// 기존 구현된 게임을 iframe으로 로드 (treasure-hunt/ 방식과 동일)
const gameFrame = document.getElementById('game-frame');
gameFrame.src = `../games/${gamePath}/index.html`;

// 게임 완료 시 postMessage로 통신
window.addEventListener('message', (event) => {
    if (event.data.type === 'treasureHuntGameComplete') {
        handleMissionComplete(event.data);
    }
});
```

---

## 2. 기존 구현 리소스 활용 계획

### 2.1 재활용 가능한 기존 구현

| 구분 | 기존 리소스 | 경로 | 활용 방식 |
|------|-----------|------|----------|
| 미니게임 20개 | 구현 완료 | `games/` | iframe으로 그대로 로드 |
| 공통 유틸리티 | common.js | `assets/js/common.js` | 확장하여 사용 |
| 공통 스타일 | common.css | `assets/css/common.css` | 테마 CSS와 함께 사용 |
| 보물찾기 코어 | core.js | `treasure-hunt/js/core.js` | 게임 정보 매핑, postMessage 통신 패턴 참조 |
| 프리셋 데이터 | default-presets.js | `treasure-hunt/js/default-presets.js` | 프리셋 구조 및 스토리 데이터 참조 |
| 관리자 시스템 | admin.js/admin.html | `treasure-hunt/` | 관리자 UI 패턴 참조 |

### 2.2 기존 미니게임 20개 목록

> **변경:** 기존 계획서의 추상적 미니게임 목록을 실제 구현된 게임으로 대체

| # | 게임 ID | 이름 | 아이콘 | 유형 | 주요 기술 |
|---|---------|------|--------|------|----------|
| 1 | game02 | 미로 탈출 | 🌀 | Canvas 기반 | Canvas API, 사전 생성 맵 |
| 2 | game03 | 짝 맞추기 | 🃏 | DOM 그리드 | CSS Grid, 이모지 페어 |
| 3 | game05 | 숫자 퍼즐 | 🔢 | DOM 그리드 | 15-puzzle, 슬라이딩 |
| 4 | game07 | 빠른 계산 | ➕ | 인터랙티브 | 난이도별 수학 문제 |
| 5 | game08 | 단어 찾기 | 🔤 | DOM 그리드 | 한글 단어 검색 |
| 6 | game11 | 순서대로 터치 | 🔢 | 인터랙티브 | 숫자 순서 터치 |
| 7 | game12 | 색깔 스피드 | 🌈 | 인터랙티브 | 스트룹 테스트 |
| 8 | game13 | 에너지 충전 | ⚡ | 센서 기반 | DeviceMotion API (흔들기) |
| 9 | game15 | 데시벨 측정기 | 🔊 | 오디오 | 마이크 + Web Audio API |
| 10 | game16 | 매직 컴퍼스 | 🧭 | 센서 기반 | DeviceOrientation API |
| 11 | game17 | 바코드 스캐너 | 📱 | 카메라 | MediaDevices + JSZBar |
| 12 | game18 | 컬러 헌터 | 🎨 | 카메라 | 카메라 색상 인식 |
| 13 | game19 | 리버스 오디오 | 🔄 | 오디오 | 역재생 오디오 추측 |
| 14 | game20 | 이모지 넌센스 | 🤔 | 인터랙티브 | 이모지 조합 추측 |
| 15 | game21 | 동시 터치 협동 | 🤝 | 멀티터치 | 2인 동시 터치 |
| 16 | game22 | 와이파이 해커 | 📡 | 인터랙티브 | 매트릭스 효과 + 비밀번호 |
| 17 | game23 | 디지털 금고 털이 | 🔓 | 인터랙티브 | 다이얼 회전 퍼즐 |
| 18 | game24 | 폭탄 해체 | 💣 | 센서 기반 | DeviceOrientation (수평 유지) |
| 19 | game25 | 복권 긁기 | 🎫 | Canvas 기반 | Canvas 스크래치 효과 |
| 20 | game27 | 절대음감 스톱워치 | ⏱️ | 인터랙티브 | 정밀 타이밍 (5초) |

### 2.3 기존 미니게임 공통 아키텍처 패턴

> **변경:** 기존 계획서의 `BaseMinigame` 클래스 상속 구조 → 함수 기반 독립 패턴

**각 미니게임은 독립적인 함수 기반 구조를 따름:**

```javascript
// ===== 게임 상태 변수 =====
let gameStarted = false;
let isPlaying = false;
let retryCount = 0;
let currentTimeLimit = 60;

// ===== 설정 로드 =====
function loadSettings() {
    const settings = JSON.parse(localStorage.getItem('game_XX_settings')) || {
        difficulty: 'normal',
        timeLimit: 60,
        theme: 'default'
    };
    return settings;
}

// ===== 게임 생명주기 =====
function initGame() {
    // 설정 로드 → 설명 모달 표시
    const settings = loadSettings();
    showInstructions('게임 제목', ['규칙1', '규칙2'], () => startGame());
}

function startGame(isRetry = false) {
    if (!isRetry) {
        retryCount = 0;
    }
    gameStarted = true;
    isPlaying = true;
    // 타이머 시작, DOM 초기화, 이벤트 바인딩
}

function endGame(isSuccess) {
    isPlaying = false;
    if (isSuccess) {
        showSuccessScreen('gameXX');  // common.js 함수
    } else {
        showFailScreen('실패 메시지', 'gameXX', () => {
            retryCount++;
            startGame(true);  // 보너스 시간 추가 후 재시도
        });
    }
}

// ===== 초기 실행 =====
window.addEventListener('DOMContentLoaded', initGame);
```

**보물찾기 모드 통합 (기존 common.js의 패턴):**
```javascript
// common.js의 showSuccessScreen()이 자동으로 보물찾기 모드를 감지
function showSuccessScreen(gameId) {
    const isTreasureHunt = window.TreasureHunt && TreasureHunt.isTreasureHuntMode();
    if (isTreasureHunt) {
        showTreasureHuntSuccess(gameId);  // postMessage로 부모에 통보
        return;
    }
    // 일반 모드 성공 화면
}
```

---

## 3. 데이터 저장 (localStorage)

> **변경:** 기존 계획서의 `THG_` 접두사 → `treasureHunt_` 접두사 (기존 구현과 일관성 유지)
> 기존 treasure-hunt/ 시스템의 저장소 키 패턴을 따름

### 3.1 저장소 키 구조

```javascript
const STORAGE_KEYS = {
    // ===== 보물찾기 시스템 (기존 treasure-hunt/와 통합) =====
    PRESETS: 'treasureHunt_presets',              // 프리셋 목록
    ACTIVE_PRESET_ID: 'treasureHunt_activePresetId', // 활성 프리셋
    PROGRESS: 'treasureHunt_progress',            // 진행 상태

    // ===== 미니게임 개별 설정 (기존 admin 시스템) =====
    GAME_CONFIGS: 'treasureHunt_gameConfigs',     // 전체 게임 설정

    // ===== 홈 트레저헌트 전용 (신규) =====
    THG_CONFIG: 'treasureHunt3_config',           // 게임 설정 (프리셋+미션 구성)
    THG_STATE: 'treasureHunt3_state',             // 게임 진행 상태
    THG_HISTORY: 'treasureHunt3_history',         // 게임 이력
    THG_ADMIN: 'treasureHunt3_admin'              // 관리자 설정 (PIN)
};
```

### 3.2 게임 설정 데이터 (treasureHunt3_config)

관리자가 프리셋을 선택하거나 직접 구성한 게임 설정값

```json
{
  "preset": "pirate",
  "theme": "pirate",
  "totalMissions": 6,
  "globalTimeLimit": 3600,
  "treasurePassword": "724",
  "playerCount": 1,
  "missions": [
    {
      "id": "m1",
      "type": "minigame",
      "gameId": "game20",
      "difficulty": "normal",
      "timeLimit": 60,
      "clue": { "type": "text", "content": "X 표시한 보물의 숨겨진" },
      "storyText": "해적선단의 첫 번째 도전이다!",
      "hintMessage": "거실 소파 뒤를 찾아봐!",
      "secretCode": "🏴‍☠️",
      "successMessage": "지도의 첫 번째 단서를 찾았다!"
    },
    {
      "id": "m2",
      "type": "findObject",
      "hints": ["부엌의 왼쪽 아래 선반에 숨어있어", "색이 동전같은 금속이네"],
      "answers": ["동전", "금 동전"],
      "clue": { "type": "number", "content": "7" },
      "storyText": "집 안에 흩어진 보물을 찾아라!"
    }
  ],
  "finalReward": {
    "message": "축하한다! 전설의 보물을 찾았다!",
    "secretCode": "TREASURE"
  },
  "createdAt": "2026-02-14T10:00:00Z"
}
```

> **주요 변경점:** 기존 계획서 대비 `finalReward`, `hintMessage`, `secretCode`, `successMessage` 필드 추가 (기존 treasure-hunt/ 프리셋 구조 반영)

### 3.3 게임 진행 상태 (treasureHunt3_state)

```json
{
  "status": "playing",
  "currentMissionIndex": 2,
  "startedAt": "2026-02-14T10:05:00Z",
  "elapsedTime": 480,
  "missionResults": [
    { "id": "m1", "status": "cleared", "grade": "A", "attempts": 1, "time": 35 },
    { "id": "m2", "status": "cleared", "grade": "B", "attempts": 2, "time": 120 }
  ],
  "collectedClues": [
    { "type": "text", "content": "X 표시한 보물의 숨겨진" },
    { "type": "number", "content": "7" }
  ],
  "hintsUsed": { "m2": 2 }
}
```

### 3.4 관리자 설정 (treasureHunt3_admin)

```json
{ "pin": "0000" }
```

---

## 4. 화면별 UI 구성

> UI 설계는 기존 UI 설계문서(홈트레저헌트_UI설계문서.docx)를 따르되, 아래 구현 방식 변경사항을 반영

### 4.1 S01 - 메인 진입 화면 (`index.html`)

**주요 로직 (변경 없음)**
- `treasureHunt3_config` 유무 확인 → 없으면 "게임 시작" 비활성화
- `treasureHunt3_state` 참고하여 "이어하기" 버튼 추가
- "게임 시작" 클릭 시 `#intro` 섹션으로 전환

### 4.2 S02 - 관리자 진입 (`admin.html`)

**주요 로직 (변경 없음)**
- PIN 4자리 입력 → 일치 시 대시보드 표시
- 5회 틀릴 시 30초 차단

### 4.3 S03 - 관리자 대시보드 (`admin.html` 내 섹션)

**주요 로직 (변경사항 반영)**
- 프리셋 선택: 5개 테마 카드 (mystery/pirate/space/magic/dino)
- 미션 구성: 기존 구현된 20개 미니게임에서 선택
  - **게임 선택 UI:** 게임 ID 기반 (game02~game27)
  - **게임 정보:** `GAME_INFO` 객체에서 이름/아이콘 자동 매핑
- 물건찾기 미션: 힌트 1~3개 + 정답 입력 (다중 답변 가능)
- 암호 3자리 + 전체 시간제한 설정
- 저장 시 `treasureHunt3_config`에 JSON 저장

```javascript
// 기존 treasure-hunt/js/core.js의 GAME_INFO를 재활용
const GAME_INFO = {
    'game02': { name: '미로 탈출', icon: '🌀', path: 'games/02-maze' },
    'game03': { name: '짝 맞추기', icon: '🃏', path: 'games/03-card-match' },
    // ... 20개 게임 매핑
};
```

### 4.4 S04 - 스토리 인트로 (`index.html#intro`)

**주요 로직 (변경 없음)**
- 프리셋 데이터에서 인트로 텍스트 로드
- 타이핑 효과 (50ms 간격)
- "미션 시작!" 클릭 시 `#hub` 섹션으로 전환

### 4.5 S05 - 미션 허브 (`index.html#hub`)

**주요 로직 (변경 없음)**
- 현재 미션 정보 표시
- 진행도 인디케이터
- 미션 타입에 따라 `play.html`로 이동
- 모든 미션 종료 시 `treasure.html`로 이동

### 4.6 S06 - 미니게임 플레이 (`play.html?type=mini&id=X`)

> **변경:** 기존 계획서의 BaseMinigame 클래스 방식 → iframe 기반 로드 방식

**구현 방식:**
```javascript
// 기존 게임을 iframe으로 로드 (treasure-hunt/ 패턴과 동일)
function loadMinigame(gameId) {
    const gameInfo = GAME_INFO[gameId];
    const iframe = document.getElementById('game-frame');
    iframe.src = `../games/${gameInfo.path}/index.html`;
}

// 게임 완료 감지 (postMessage 기반)
window.addEventListener('message', (event) => {
    if (event.data.type === 'treasureHuntGameComplete') {
        handleMissionComplete(event.data);
    }
    if (event.data.type === 'treasureHuntComplete') {
        handleAllComplete(event.data);
    }
});
```

**기존 미니게임과의 통합:**
- 각 미니게임의 `showSuccessScreen(gameId)` 호출 시 `common.js`가 자동으로 보물찾기 모드 감지
- `window.TreasureHunt` 객체를 통해 현재 게임의 보물찾기 정보 조회
- 성공 시 `window.parent.postMessage()`로 부모 프레임에 통보
- 비밀번호, 힌트 메시지, 성공 메시지 자동 표시

### 4.7 S07 - 물건 찾기 미션 (`play.html?type=find&id=X`)

**주요 로직 (변경 없음)**
- 힌트 카드 표시 (최대 3개)
- 정답 비교: `input.trim().replace(/\s/g,'').toLowerCase() === answer`
- 3회 초과 실패 시 자동 힌트 전개

### 4.8 S08 - 보물 상자 (`treasure.html`)

**주요 로직 (변경 없음)**
- 테마별 인터랙티브 암호 입력 UI
- 정답 맞추면 최종 보상 표시

---

## 5. 핵심 기능 구현

### 5.1 storage.js - localStorage 관리 유틸

> **변경:** 기존 계획서의 `THG_` 접두사 → `treasureHunt3_` 접두사

```javascript
const Storage = {
    KEYS: {
        CONFIG: 'treasureHunt3_config',
        STATE: 'treasureHunt3_state',
        HISTORY: 'treasureHunt3_history',
        ADMIN: 'treasureHunt3_admin'
    },
    get(key) { /* JSON.parse + try/catch */ },
    set(key, value) { /* JSON.stringify + 용량 체크 */ },
    remove(key) { /* localStorage.removeItem */ },
    getAvailableSpace() { /* 남은 용량 체크 */ }
};
```

### 5.2 theme-manager.js - 테마 관리 유틸

> **변경:** 기존 계획서의 5개 테마(mystery/pirate/space/magic/dino) 유지
> 기존 treasure-hunt/의 6개 테마(pirate/space/magic/jungle/spy/custom)와 다른 세트 사용

```javascript
const ThemeManager = {
    current: null,
    themes: {
        mystery: { name: '미스테리 탐정단', primary: '#2E4057', accent: '#FFD700' },
        pirate:  { name: '해적 보물섬',     primary: '#8B4513', accent: '#FFD700' },
        space:   { name: '우주 탐험대',     primary: '#1e3a8a', accent: '#00D4FF' },
        magic:   { name: '마법학교 비밀',   primary: '#7c3aed', accent: '#FF6B9D' },
        dino:    { name: '공룡시대 발굴단', primary: '#15803d', accent: '#FF8C42' }
    },
    apply(themeId) { /* CSS 변수 업데이트 + data-theme 속성 설정 */ },
    getColors() { /* 현재 테마 색상 반환 */ }
};
```

### 5.3 game-engine.js - 게임 상태 관리

> **변경:** 기존 계획서의 클래스 기반 → 함수/객체 기반 (기존 구현 패턴과 일관성)

```javascript
const GameEngine = {
    config: null,
    state: null,

    init() {
        this.config = Storage.get(Storage.KEYS.CONFIG);
        this.state = Storage.get(Storage.KEYS.STATE);
    },

    startNewGame() { /* STATE 초기화 */ },
    resumeGame() { /* 이어하기 */ },
    getCurrentMission() { /* 현재 미션 정보 반환 */ },

    completeMission(result) {
        /* 미션 종료 처리 + 단서 저장 + postMessage 처리 */
    },

    failMission() { /* 실패 처리 (재도전 카운트) */ },
    skipMission() { /* 건너뛰기 (3회 초과 시) */ },
    isAllCompleted() { /* 모든 미션 종료 여부 */ },
    saveState() { /* treasureHunt3_state 저장 */ },
    getProgress() { /* 진행도 반환 */ }
};
```

### 5.4 미니게임-보물찾기 통합 메커니즘

> **신규 섹션:** 기존 구현된 postMessage 기반 통신 패턴 설명

```
┌─────────────────────────────────────────────┐
│ play.html (미션 플레이 페이지)                  │
│   ┌─────────────────────────────────────┐   │
│   │ <iframe> games/XX-game/index.html   │   │
│   │   ├── game.js (게임 로직)            │   │
│   │   └── common.js (공통 유틸)          │   │
│   │       └── showSuccessScreen()       │   │
│   │           ├── TreasureHunt 모드 감지  │   │
│   │           └── postMessage() 전송     │   │
│   └─────────────────────────────────────┘   │
│   ↑ message 이벤트 수신                       │
│   └── handleMissionComplete()               │
│       ├── 단서 저장                           │
│       ├── 진행 상태 업데이트                    │
│       └── 다음 미션 / 보물 상자 이동            │
└─────────────────────────────────────────────┘
```

---

## 6. 특수 장치 기능 및 API 활용

> **업데이트:** 기존 구현에서 실제 사용 중인 API와 매핑

| API | 용도 | 미니게임 | 호환성 주의 |
|-----|------|---------|-----------|
| DeviceMotionEvent | 흔들기 감지 | game13 (에너지 충전) | iOS: `requestPermission()` 필요 |
| DeviceOrientationEvent | 방향/기울기 감지 | game16 (컴퍼스), game24 (폭탄 해체) | iOS: `requestPermission()` 필요 |
| MediaDevices.getUserMedia | 마이크 접근 | game15 (데시벨), game19 (리버스 오디오) | HTTPS 필수 |
| MediaDevices.getUserMedia | 카메라 접근 | game17 (바코드), game18 (컬러 헌터) | HTTPS 필수 |
| Web Audio API (AudioContext) | 효과음 합성 | 전체 게임 (common.js) | 사용자 인터랙션 후 resume 필요 |
| Web Audio API (AnalyserNode) | 주파수 분석 | game15, game19 | AnalyserNode 체이닝 |
| Canvas API | 그래픽 렌더링 | game02 (미로), game25 (스크래치) | 2D 컨텍스트 |
| Vibration API | 터치 피드백 | 전체 게임 (성공/실패/버튼) | iOS Safari 미지원 |
| Touch Events | 멀티터치 | game21 (동시 터치), game23 (금고) | `touch-action: none` 필요 |

### 6.1 iOS 권한 요청 패턴 (기존 구현 기반)

```javascript
// 기존 게임들에서 사용하는 공통 패턴
async function requestDevicePermission() {
    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        try {
            const permission = await DeviceOrientationEvent.requestPermission();
            return permission === 'granted';
        } catch (e) {
            console.error('Permission denied:', e);
            return false;
        }
    }
    return true; // Android는 자동 허용
}
```

---

## 7. 테마 CSS 변수 설정

> **변경 없음:** 기존 계획서의 CSS Custom Properties 방식 유지

```css
:root {
    --theme-primary: #2E4057;
    --theme-secondary: #048A81;
    --theme-accent: #FFD700;
    --theme-bg: #0A0A2E;
    --theme-bg-card: rgba(255,255,255,0.1);
    --theme-text: #FFFFFF;
    --theme-text-sub: #B0B0B0;
    --theme-btn-radius: 28px;
}

[data-theme='pirate'] {
    --theme-primary: #8B4513;
    --theme-secondary: #20B2AA;
    --theme-accent: #FFD700;
    --theme-bg: #1A0F00;
    --theme-text: #F5E6C8;
    --theme-btn-radius: 8px;
}
```

---

## 8. 개발 일정 (Phase별)

> **변경:** 미니게임 20개가 이미 구현되어 있으므로, Phase 3~4의 미니게임 개발 작업 제거. 전체 일정 단축.

| Phase | 기간 | 내용 | 마일스톤 |
|-------|------|------|---------|
| **Phase 1: 기초 구축** | 1주차 | 프로젝트 세팅, 멀티페이지 네비게이션, storage.js, 테마 시스템 | 기본 화면 전환, 저장소 CRUD |
| **Phase 2: 관리자 시스템** | 2주차 | PIN 입력, 프리셋 카드 UI, 미션 구성 (기존 20개 게임 선택), 물건찾기 설정 | 프리셋 설정/저장 완성 |
| **Phase 3: 게임 플레이** | 3주차 | 미션 허브, iframe 게임 로드, postMessage 통신, 물건찾기 미션, 단서 수집 | 전체 게임 플로우 완성 |
| **Phase 4: 보물 상자 + 테마** | 4주차 | 보물 상자 인터랙션 5가지, 테마 CSS 5개, 효과음/애니메이션 | 전체 게임플레이 완성 |
| **Phase 5: 테스트/출시** | 5주차 | 크로스 브라우저 테스트, 에러 처리, 성능 최적화, 게임 밸런싱 | 출시 완료 |

> **기존 계획 대비 2주 단축:** 미니게임 20개 개발 (3~4주차)이 불필요하므로 Phase 3~4 통합

### 8.1 Phase별 완료 체크리스트

**Phase 1 완료 조건:**
- [ ] 멀티페이지 네비게이션 동작 (index.html → admin.html → play.html → treasure.html)
- [ ] localStorage CRUD 동작 (get/set/remove)
- [ ] CSS Custom Properties 기반 테마 전환 (최소 2개 테마)
- [ ] 기본 레이아웃 완성

**Phase 2 완료 조건:**
- [ ] PIN 인증 관리자 화면 완성
- [ ] 5개 프리셋 카드 UI 선택 가능
- [ ] 기존 20개 미니게임 목록에서 게임 선택/추가/삭제/재정렬
- [ ] 물건찾기 미션 설정 (힌트 3개 + 정답)
- [ ] 저장 완료 시 `treasureHunt3_config`에 올바른 JSON 저장

**Phase 3 완료 조건:**
- [ ] 미션 허브에서 현재 미션 표시 + 진행도
- [ ] iframe으로 기존 미니게임 로드 + postMessage 통신 동작
- [ ] 물건찾기 미션: 힌트 3개 + 정답 입력 완성
- [ ] 단서 수집 표시
- [ ] 미션 클리어/실패/재시도 플로우 완성

**Phase 4 완료 조건:**
- [ ] 보물 상자 테마별 인터랙션 5가지 완성
- [ ] 5개 테마 CSS 완성
- [ ] 효과음 (Web Audio API 합성음) 완성
- [ ] 컨페티/파티클 애니메이션 완성

**Phase 5 완료 조건:**
- [ ] Chrome/Safari 크로스 브라우저 호환성 테스트
- [ ] 센서 권한 요청 플로우 (iOS/Android) 정상 동작
- [ ] 전체 게임플레이 QA 테스트 완료
- [ ] 성능: 초기 로드 3초 이하, 화면 전환 0.3초 이하

---

## 9. 테스트 계획

| 테스트 항목 | 범위 | 도구 |
|-----------|------|------|
| 단위 테스트 | storage.js, game-engine.js | 수동 테스트 |
| 통합 테스트 | 전체 게임 플로우 + iframe 통신 + 저장 데이터 | 수동 테스트 |
| 호환성 테스트 | 센서 미니게임 (game13, game16, game24) | iOS Safari, Android Chrome |
| 크로스 브라우저 | Safari, Chrome, Samsung Internet | 실기기 테스트 |
| 게임 밸런싱 | 11~13세 기준 난이도/시간 밸런스 | 게임 QA 테스트 |

---

## 10. 배포 및 고려사항

### 10.1 정적 호스팅
- GitHub Pages, Netlify, Vercel 등 정적 호스팅 활용
- HTTPS 필수 (카메라/마이크/센서 API 요구)

### 10.2 PWA 구현 (선택사항)
- Service Worker 리소스 캐싱
- manifest.json 홈 화면 추가
- 초기 필수사항은 아님

### 10.3 알려진 제약 조건
- localStorage 용량 제한: 브라우저별 5~10MB (게임 데이터는 수 KB이므로 충분)
- 기기/브라우저 한정: localStorage는 온라인 동기화 불가
- iOS Safari 프라이빗 모드: 센서 권한 재요청 필요
- iframe 보안: 동일 출처 정책(Same-Origin Policy) 준수 필요

---

## 부록: 기존 계획서 대비 변경 이력

| 항목 | 기존 계획서 (v1.0) | 업데이트 (v2.0) | 변경 사유 |
|------|-------------------|-----------------|----------|
| 앱 구조 | SPA (hash 라우팅) | 멀티페이지 | 기존 게임 구현이 멀티페이지 방식 |
| 미니게임 아키텍처 | `BaseMinigame` 클래스 상속 | 함수 기반 독립 패턴 | 기존 20개 게임이 함수 기반으로 구현 |
| 미니게임 개발 | 신규 20개 개발 | 기존 20개 재활용 (iframe) | 이미 구현 완료됨 |
| 저장소 접두사 | `THG_` | `treasureHunt3_` | 기존 시스템과 네이밍 일관성 |
| 테마 목록 | mystery/pirate/space/magic/dino | 동일 (유지) | - |
| 게임-보물찾기 통신 | 직접 호출 | postMessage (iframe) | 기존 treasure-hunt/ 패턴 |
| 개발 일정 | 7주 | 5주 | 미니게임 개발 불필요로 2주 단축 |
| 관리자 게임 선택 | 추상적 목록 | 실제 게임 ID 기반 (game02~game27) | 기존 구현과 매핑 |
